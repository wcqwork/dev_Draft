<script>
    $(function(){
        var _prodListRightIcon = `
        <div class="prod_show_icon_right">
            <ul>
                <li class="icon_first">
                    <i class="fa fa-shopping-cart icon_right" aria-hidden="true"></i>
                    <span class="prod_item_txt" style="display: none; opacity: 0;">Add
                        to Cart</span>
                </li>
                <li class="icon_fir">
                    <i class="icon_right" aria-hidden="true">
                        <svg width="18px" height="12px" viewBox="0 0 14 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                            <title>眼睛</title>
                            <desc>Created with Sketch.</desc>
                            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                <g id="products-list-交互效果" transform="translate(-931.000000, -541.000000)" fill="#2B2B2A">
                                    <g id="分组-9" transform="translate(670.000000, 305.000000)">
                                        <g id="分组-8" transform="translate(190.000000, 200.000000)">
                                            <g id="眼睛" transform="translate(71.000000, 36.000000)">
                                                <g id="分组">
                                                    <path d="M7,0.0121637427 C3.7657346,0.0121637427 1.02196682,1.68 0.000663507109,4.00436647 C1.02196682,6.32873294 3.7657346,7.9965692 7,7.9965692 C10.2342654,7.9965692 12.9780332,6.32873294 13.9993365,4.00436647 C12.9780332,1.68 10.2342654,0.0121637427 7,0.0121637427 Z M7,6.99851852 C5.24104265,6.99851852 3.81516588,5.6580117 3.81516588,4.00436647 C3.81516588,2.35072125 5.24104265,1.01021442 7,1.01021442 C8.75895735,1.01021442 10.1848341,2.35072125 10.1848341,4.00436647 C10.1848341,5.6580117 8.75895735,6.99851852 7,6.99851852 Z" id="形状" fill-rule="nonzero"></path>
                                                    <path d="M4.87677725,4.00436647 L4.87677725,4.00436677 C4.87677743,5.10678237 5.82737725,6.00046814 7,6.00046814 C8.17262275,6.00046797 9.12322275,5.10678237 9.12322275,4.00436677 C9.12322275,2.90195118 8.17262275,2.00826541 7,2.00826541 C5.82737725,2.00826541 4.87677725,2.90195118 4.87677725,4.00436677 L4.87677725,4.00436647 Z" id="路径"></path>
                                                </g>
                                            </g>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </svg>
                    </i>
                    <span class="prod_item_txt">Quick View</span>
                </li>
                <li class="icon_collect">
                    <i class="prodlist-collect-btn block-icon block-iconline1
                        icon_right"></i>
                    <span class="prod_item_txt">Collection</span>
                </li>
            </ul>
        </div>
        `
        var parentContainer = $(".sitewidget-prodlist ul.grid-container>li");
        parentContainer.each(function(index,elem){
            $(elem).find(".prodlist-picbox").append(_prodListRightIcon);
            // add cart
            $(elem).find(".icon_first").unbind('click').bind('click',function(){
                $(elem).find('.prodlist-parameter-btns .btn-wrap-fresh-single .prodlist-pro-addcart-btn span').trigger('click')
            });
            // Quick View
            $(elem).find(".icon_fir").unbind('click').bind('click',function(){
                // $(elem).find('.prodlist-cell>a img').trigger('click');
                $(elem).find('.prod_show_button').trigger('click');
            });
            // 收藏
            $(elem).find(".icon_collect").unbind('click').bind('click',function(){
                $(elem).find('.prodlist-add-wishlist .prodlist-collect-btn').trigger('click');
                var _that = this;
                setTimeout(function(){
                    $(_that).find('.prodlist-collect-btn').removeClass("block-iconline1");
                    $(_that).find('.prodlist-collect-btn').addClass("block-iconshixin");
                },1000)
            });

            $(".sitewidget-prodlist .prod_show_icon_right li").mouseenter(function() {
                $(this).find("span").show().animate({
                    opacity: '1'
                }, 10);
            })

            $(".sitewidget-prodlist .prod_show_icon_right li").mouseleave(function() {
                $(this).find("span").hide().animate({
                    opacity: '0'
                }, 10);
            })
        });

        getCateListHandler();
        $(".prodfield-right input").change(function(){
            console.log('分类 1111');
            $(".prodfield-container .prodfield-form").submit();
            getCateListHandler();
        });
        function getCateListHandler(){
                // 分类筛选
                function getCateListFun(){
                    var _cateList= [];
                    $(".prodfield-right input:checked").each(function(index,elem){
                        var _text = $(elem).parent().find('label').text();
                        _cateList.push({label:_text,index:index});
                    })
                    return _cateList;
                }

                var cateListAll = getCateListFun();

                if($(".cateContaner_box").length > 0){
                    $(".cateContaner_box").remove();
                }
                var parentEl = $(`<div class="cateContaner_box"><div id="cateContainer"></div><div class="clear_container"><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <title>形状</title>
                    <desc>Created with Sketch.</desc>
                    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g id="products-list-交互效果" transform="translate(-370.000000, -382.000000)" fill="#F9CC3D" fill-rule="nonzero">
                            <g id="分组-5" transform="translate(370.000000, 305.000000)">
                                <g id="刷新" transform="translate(0.000000, 77.000000)">
                                    <path d="M7.9999821,1.27178577e-16 C3.58886517,1.27178577e-16 0,3.58886919 0,7.99999105 C0,12.4111129 3.58886517,16 8,16 C12.4111348,16 16,12.4111308 16,7.99999105 C16,3.58885129 12.4111169,0 7.9999821,1.27178577e-16 Z M7.89883812,12 C6.13549423,12 4.63289193,10.8379861 4.05469123,9.21559995 L4.06055231,9.21311252 C4.02461649,9.13820461 4,9.05682172 4,8.96748255 C4,8.65858536 4.24153089,8.4081699 4.53951259,8.4081699 C4.77917664,8.4081699 4.97550427,8.57289144 5.04585524,8.7970084 L5.0534197,8.79379941 C5.46992323,10.0081253 6.5863675,10.8813619 7.89883513,10.8813619 C9.5653236,10.8813619 10.9209648,9.47597807 10.9209648,7.74832035 C10.9209648,6.0206719 9.56533255,4.61527883 7.89883513,4.61527883 C7.53312104,4.61527883 7.18513922,4.68914243 6.86047051,4.8132487 L7.2408007,5.5692583 C7.28530823,5.61895005 7.31270887,5.68584509 7.31270887,5.75932904 C7.31270887,5.91552502 7.16228057,6.03621408 7.03767692,6.03896588 C7.03584533,6.03896588 7.03397711,6.03896588 7.03214553,6.03896588 C7.02820761,6.03896588 7.02448949,6.03896588 7.02055157,6.03871904 L4.32536021,5.91879038 C4.22920177,5.91444211 4.14225617,5.85736387 4.09774917,5.76861366 C4.05324165,5.68011024 4.0577106,5.57360527 4.10934313,5.48924216 L5.55717709,3.12933894 C5.60880957,3.04522169 5.70048062,2.99663121 5.79640083,3.00018202 C5.89255927,3.00453028 5.97946729,3.06164638 6.02397607,3.15039659 L6.35653813,3.81144783 C6.83317247,3.61002291 7.35319691,3.49668335 7.89884519,3.49668335 C10.1601354,3.49668335 12,5.40403366 12,7.74835017 C12,10.0926481 10.1601354,11.9999613 7.89882729,11.9999613 L7.89883812,12 Z" id="形状" transform="translate(8.000000, 8.000000) scale(-1, 1) translate(-8.000000, -8.000000) "></path>
                                </g>
                            </g>
                        </g>
                    </g>
                </svg>Clear filters</div></div>`);
                parentEl.find(".clear_container").unbind('click').bind('click',function(){
                    $(".prodfield-right input:checked").each(function(index,elem){
                        $(this).attr('checked',false);
                    })
                    getCateListHandler();
                    $(".prodfield-container .prodfield-form").submit();
                })
                cateListAll.forEach(function(item,index){
                    var _itemEl = $('<div class="item-cate-div"><div class="item-cate-close" data-closeindex="'+item.index+'"><svg t="1670406652994" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3235" width="16" height="16"><path d="M704.28672 309.20704l28.95872 28.9792L334.6432 736.78848l-28.95872-28.9792z" fill="#231815" p-id="3236"></path><path d="M341.03296 315.5968l398.60224 398.60224-28.95872 28.95872-398.60224-398.60224z" fill="#231815" p-id="3237"></path></svg></div><div class="item-cate">'+item.label+'</div></div>');
                    _itemEl.find(".item-cate-close").unbind('click').bind('click',function(){
                        var _index = parseInt($(this).attr("data-closeindex"));
                        $(".prodfield-right input:checked").eq(_index).attr('checked',false);
                        getCateListHandler();
                        $(".prodfield-container .prodfield-form").submit();
                    })
                    parentEl.find("#cateContainer").append(_itemEl);
                }); 
                if(cateListAll.length > 0){
                    $(".sitewidget-prodFilter").parent().parent().parent().prepend(parentEl);
                }
        }
    })
</script>
<script>
    $(function(){
        onloadHack(function(){
            setTimeout(function(){
                console.log('移动端');
                // 移动端
                var _closeBtn =$(`<div class="close close-bar"><div class="close-bar-btn btn-round round-animation" tabindex="0">
                    <svg t="1670576979559" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2983" width="22" height="22"><path d="M557.312 513.248l265.28-263.904c12.544-12.48 12.608-32.704 0.128-45.248-12.512-12.576-32.704-12.608-45.248-0.128l-265.344 263.936-263.04-263.84C236.64 191.584 216.384 191.52 203.84 204 191.328 216.48 191.296 236.736 203.776 249.28l262.976 263.776L201.6 776.8c-12.544 12.48-12.608 32.704-0.128 45.248 6.24 6.272 14.464 9.44 22.688 9.44 8.16 0 16.32-3.104 22.56-9.312l265.216-263.808 265.44 266.24c6.24 6.272 14.432 9.408 22.656 9.408 8.192 0 16.352-3.136 22.592-9.344 12.512-12.48 12.544-32.704 0.064-45.248L557.312 513.248z" p-id="2984"></path></svg></div></div>`);
                var _paraentCateCon = $(".sitewidget-prodFilter").parent().parent().parent();
                var _filterContent = _paraentCateCon.clone();
                var _leftContainer = $(`<div class="mbl-overlay-container"></div>`);
                var _mskContainer = $(`<div class="mbl-overlay-bg"></div>`);
                // 关闭按钮
                _closeBtn.unbind('click').bind('click',function(){
                    $("body .mbl-overlay-container").hide();
                    $("body .mbl-overlay-bg").hide();
                })
                _leftContainer.append(_closeBtn);
                _leftContainer.append(_filterContent)
                $("body").append(_leftContainer);
                $("body").append(_mskContainer);
                
                // 按钮
                var _phoneBtnContainer =  $(`<div class="btn-filter">
                        <a href="#" class="btn btn-small">
                            <svg width="22px" height="18px" viewBox="0 0 42 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                <title>分组 47</title>
                                <desc>Created with Sketch.</desc>
                                <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                    <g id="分组-47" fill="#49B7AE" fill-rule="nonzero">
                                        <rect id="矩形" x="0" y="0" width="42" height="3" rx="1.5"></rect>
                                        <rect id="矩形-copy-27" x="6" y="8" width="30" height="3" rx="1.5"></rect>
                                        <rect id="矩形-copy-28" x="13" y="15" width="16" height="3" rx="1.5"></rect>
                                    </g>
                                </g>
                            </svg>
                        <span class="text">Filter</span>
                        </a></div>`);
                _phoneBtnContainer.unbind('click').bind('click',function(){
                    $("body .mbl-overlay-container").show();
                    $("body .mbl-overlay-bg").show();
                })
                _paraentCateCon.find('>div[data-type="locations"]').hide();
                _paraentCateCon.append(_phoneBtnContainer);
            },200);
        })
    })    
</script>